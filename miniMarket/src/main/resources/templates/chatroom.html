<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>hi</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
   
$(document).ready(function(){
   var memberId = $("#memberId").val();
   var chatroomNo = $("#chatroomNo").val();
   
   
   
   $('#addBtn').on('click', function () {
      console.log("클릭");
      //function addAjax(){
          $.ajax({
              method: "Post",
              url: "/addMessage",
              data: {memberId : memberId , chatMessage : $("#chatMessage").val() , chatroomNo : chatroomNo},
              success: function(data) {
                 console.log("성공")
              },
              error: function (error) {
                   alert('data error');
               }
          });
      //}
   });
   //function getAjax(){
   setInterval(function(){
      $.ajax({
           method: "Get",
           url: "/getAllMessages",
           data: {chatroomNo : chatroomNo},
           success: function(data) {
              console.log("리스트 출력");
              $('.chat-list').empty();
               $.each(data , function(i){
                   console.log(data[i]);
                   var html = '[' +data[i].memberId + '] ' + data[i].chatMessage + ' : ' + data[i].chatDate.substring(10, 16);
                   $('.chat-list').prepend('<div>' + html + '</div>')
              });
              
              
           },  
           error: function (error) {
                alert('data error');
            }
       });   
   }, 3000);
   //}
})
    
</script>

</head>
<body>

	
   <h1>어서오세요 채팅의 숲</h1>
      <input type="text" name="memberId" placeholder="작성자"  th:value="${chatroom.memberId}" readonly="readonly" id="memberId">
      <input type="text" name="chatMessage" placeholder="내용" id="chatMessage">
      <input type="hidden" name="chatroomNo" th:value="${chatroom.chatroomNo}" id="chatroomNo">
      <button type="button" id="addBtn">보내기</button>
   <div class="chat-list"></div>

</body>

</html>